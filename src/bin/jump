#!/bin/bash

RC=0


if [ -z "$*" ]; then
	location=$(load user location)
	path="${location:-$DEFAULT_LOCATION}"
else
	path="$*"
fi

path = "$(roomPath "$path")"

if [ -z "$path" ]; then
	echo "No location given"
	RC=1
elif grep -q '[.*]' <<< "$path"; then
	echo "Illegal charachters in jump command: $*"
	RC=2
elif ! roomExists "$path"; then
	echo "Room not found: $path"

		
	if [ "$(basename "${BASH_SOURCE[0]}")" = "jumpf" ]; then
		echo "Force creating room $path"
		roomCreate "$path"
	else
		RC=3
	fi
fi


prev_location=$(pwd)

if [ "$RC" = 0 ] && cd "$path"; then
	location=$($LOCATION)
	if [ ! -d "players" ]; then
		mkdir -p "players"
	fi

	if [ -e "$prev_location/players/$USERNAME" ]; then
		rm "$prev_location/players/$USERNAME"
	fi

	touch "players/$USERNAME"
	
	save user location

	source "$BIN/look"
fi

$(exit "$RC")

